{% extends "base.html" %}
{% block content %}
  <h2 class="text-2xl font-semibold mb-4">Submit an Article URL</h2>

  <form id="submit-form" class="space-y-4">
    <input type="url" id="url-input" placeholder="https://example.com/article"
           class="w-full px-4 py-2 border rounded" required>
    <button type="submit" id="submit-btn"
      class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
      Convert to Audio
    </button>
  </form>

  <div id="status" class="mt-4"></div>

  <script>
    const form = document.getElementById('submit-form')
    const statusDiv = document.getElementById('status')
    form.addEventListener('submit', async e => {
      e.preventDefault()
      statusDiv.innerHTML = `
        <div class="flex items-center space-x-2">
          <svg class="animate-spin h-5 w-5 text-blue-600" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10"
                    stroke="currentColor" stroke-width="4" fill="none"/>
            <path class="opacity-75" fill="currentColor"
                  d="M4 12a8 8 0 018-8v8H4z"/>
          </svg>
          <span>Processing...</span>
        </div>`
      try {
        const url = document.getElementById('url-input').value
        const res = await fetch('/submit', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({url})
        })
        const data = await res.json()
        if (!res.ok) throw new Error(data.detail||data.error)
        // success â†’ redirect
        window.location.href = '/items'
      } catch(err) {
        statusDiv.innerHTML = `
          <div class="text-red-600">
            <strong>Error:</strong> ${err.message}
          </div>`
      }
    })
  </script>
{% endblock %}